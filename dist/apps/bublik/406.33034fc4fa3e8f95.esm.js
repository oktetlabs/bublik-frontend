"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[406],{47406:(e,r,s)=>{s.r(r),s.d(r,{default:()=>v});var i=s(50358),o=(s(14209),s(75751),s(67859),s(94641),s(5993),s(75044),s(52983)),a=s(56712),l=s(49516),t=s(99068),n=s(32131),m=s(25673),d=s(18294),u=s(13657),c=s(97458);const p=["isCompromised","isLoading","isError","isActive"],g=(0,o.memo)((0,o.forwardRef)(((e,r)=>{let{isCompromised:s,isLoading:o,isError:a,isActive:l}=e,t=(0,i.Z)(e,p);const n=s?"Run is compromised":"Define as compromised";return(0,c.jsx)(u.zx,Object.assign({variant:"secondary",iconLeft:"EyeHide20x20",isLoading:o,disabled:a,"data-compromised":s,className:(0,u.m6)(l&&"bg-primary text-white",s?"border-2 border-bg-error text-white hover:border-bg-error bg-bg-error":"border-2 border-transparent hover:border-[#94b0ff]")},t,{ref:r,children:n}))})));g.displayName="CompromiseStatusButton";const b=(0,o.forwardRef)((({comment:e="",bugId:r="",bugUrl:s="",onDeleteClick:i},o)=>(0,c.jsxs)("div",{className:"flex flex-col gap-4 p-3 w-[320px]",ref:o,children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsx)("span",{className:"text-[0.875rem] font-semibold leading-[1.125rem]",children:"Run is compromised"}),(0,c.jsx)("button",{className:"p-px transition-colors rounded-md text-primary hover:bg-primary-wash active:text-white active:bg-primary",onClick:i,"aria-label":"Remove compomised status",children:(0,c.jsx)(d.P.Bin22x22,{})})]}),(0,c.jsx)("p",{className:"text-[0.875rem] text-text-menu leading-[0.875rem] break-all",children:e}),(0,c.jsxs)("a",{className:"w-fit text-primary text-[0.875rem] leading-[1.125rem] bg-primary-wash px-2 py-1 rounded",href:s,target:"_blank",rel:"noreferrer",children:["Bug ",r]})]})));b.displayName="CompromiseInfo";const x=t.Ry().shape({comment:t.Z_().required("Comment is required"),bugId:t.Rx().typeError("Bug ID must be a number").required("Bug ID is required").positive("Bug ID should be positive number").integer("Bug ID should be integer"),bugStorageKey:t.Z_().required("Key is required")}),h=e=>{const{onSubmit:r,initialValues:s,bugStorageKeys:i}=e,o=(0,l.TA)({initialValues:s,onSubmit:r,validationSchema:x});return(0,c.jsx)("div",{className:"min-w-[320px] py-6 px-4",children:(0,c.jsx)(l.Hy,{value:o,children:(0,c.jsx)(l.l0,{onSubmit:o.handleSubmit,children:(0,c.jsx)("fieldset",{children:(0,c.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,c.jsx)("span",{className:"text-[0.875rem] leading-[1.125rem] font-semibold",children:"Define as compromised"}),(0,c.jsx)(u.nv,{label:"Comment",name:"comment",placeholder:"Comment",autoComplete:"off"}),(0,c.jsx)(u.nv,{label:"Bug ID",name:"bugId",placeholder:"Bug ID",autoComplete:"off"}),(0,c.jsx)(u.mg,{name:"bugStorageKey",label:"Bugs storage",options:i}),(0,c.jsx)("div",{className:"flex items-center gap-1",children:(0,c.jsx)(u.zx,{variant:"primary",className:"w-full",type:"submit",children:"Submit"})})]})})})})})};h.displayName="CompromiseForm";const f=({runId:e})=>{var r;const[s,i]=(0,o.useState)(!1),{data:l,isLoading:t,isError:d}=(0,m.z$)(),{data:p,isLoading:x,isError:f}=m.Ul.endpoints.getRunDetails.useQueryState(null!=e?e:a.skipToken),[v]=(0,m.Js)(),[y]=(0,m.op)(),j=x||t,C=f||d,S=(0,o.useMemo)((()=>Object.entries((null==l?void 0:l.logs)||{}).filter((([e])=>"LOGS_BASE"!==e)).map((([e,r])=>({value:e,displayValue:r.name})))),[null==l?void 0:l.logs]),w=(0,o.useMemo)((()=>{var e,r,s,i,o;return{bugStorageKey:null!=(e=null==S||null==(r=S[0])?void 0:r.value)?e:"",bugId:null!=(s=null==p||null==(i=p.compromised.bug_id)?void 0:i.toString())?s:"",comment:null!=(o=null==p?void 0:p.compromised.comment)?o:""}}),[S,null==p?void 0:p.compromised]),I=(0,o.useCallback)((async({bugId:r,comment:s,bugStorageKey:i})=>{e&&await v({bugId:parseInt(r),comment:s,referenceKey:i,runId:parseInt(e)})}),[e,v]),N=(0,o.useCallback)((async()=>{e&&await y(e)}),[y,e]);return(0,c.jsxs)(u.J2,{onOpenChange:i,children:[(0,c.jsx)(u.xo,{asChild:!0,"aria-label":"Compromised form",children:(0,c.jsx)(g,{isCompromised:(null==p||null==(r=p.compromised)?void 0:r.status)||!1,isLoading:j,isError:C,isActive:s})}),(0,c.jsx)(u.yk,{asChild:!0,sideOffset:5,children:(0,c.jsx)("div",{className:"bg-white rounded-md shadow-popover",children:p&&l?null!=p&&null!=(k=p.compromised)&&k.status?(0,c.jsx)(b,{comment:p.compromised.comment,bugId:p.compromised.bug_id,bugUrl:p.compromised.bug_url,onDeleteClick:N}):(0,c.jsx)(n.M,{children:(0,c.jsx)(h,{bugStorageKeys:S,initialValues:w,onSubmit:I})}):null})})]});var k};f.displayName="CompromiseStatusContainer";const v=f}}]);