"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[677],{60677:(e,r,s)=>{s.r(r),s.d(r,{default:()=>y});s(75751),s(67859),s(94641),s(5993),s(75044);var i=s(52983),o=s(56712),a=s(35562),l=s(56403),t=s(67912),n=s(11095),m=(s(14209),s(69175)),d=s(97458);const u=["isCompromised","isLoading","isError","isActive"],c=(0,i.memo)((0,i.forwardRef)(((e,r)=>{let{isCompromised:s,isLoading:i,isError:o,isActive:a}=e,l=(0,n.Z)(e,u);const t=s?"Run is compromised":"Define as compromised";return(0,d.jsx)(m.zx,Object.assign({variant:"secondary",iconLeft:"EyeHide20x20",isLoading:i,disabled:o,"data-compromised":s,className:(0,m.m6)(a&&"bg-primary text-white",s?"border-2 border-bg-error text-white hover:border-bg-error bg-bg-error":"border-2 border-transparent hover:border-[#94b0ff]")},l,{ref:r,children:t}))})));c.displayName="CompromiseStatusButton";var p=s(49516),g=s(99068);const b=g.Ry().shape({comment:g.Z_().required("Comment is required"),bugId:g.Rx().typeError("Bug ID must be a number").required("Bug ID is required").positive("Bug ID should be positive number").integer("Bug ID should be integer"),bugStorageKey:g.Z_().required("Key is required")}),x=e=>{const{onSubmit:r,initialValues:s,bugStorageKeys:i}=e,o=(0,p.TA)({initialValues:s,onSubmit:r,validationSchema:b});return(0,d.jsx)("div",{className:"min-w-[320px] py-6 px-4",children:(0,d.jsx)(p.Hy,{value:o,children:(0,d.jsx)(p.l0,{onSubmit:o.handleSubmit,children:(0,d.jsx)("fieldset",{children:(0,d.jsxs)("div",{className:"flex flex-col gap-5",children:[(0,d.jsx)("span",{className:"text-[0.875rem] leading-[1.125rem] font-semibold",children:"Define as compromised"}),(0,d.jsx)(m.nv,{label:"Comment",name:"comment",placeholder:"Comment",autoComplete:"off"}),(0,d.jsx)(m.nv,{label:"Bug ID",name:"bugId",placeholder:"Bug ID",autoComplete:"off"}),(0,d.jsx)(m.mg,{name:"bugStorageKey",label:"Bugs storage",options:i}),(0,d.jsx)("div",{className:"flex items-center gap-1",children:(0,d.jsx)(m.zx,{variant:"primary",className:"w-full",type:"submit",children:"Submit"})})]})})})})})};x.displayName="CompromiseForm";var h=s(39636);const v=(0,i.forwardRef)((({comment:e="",bugId:r="",bugUrl:s="",onDeleteClick:i},o)=>(0,d.jsxs)("div",{className:"flex flex-col gap-4 p-3 w-[320px]",ref:o,children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsx)("span",{className:"text-[0.875rem] font-semibold leading-[1.125rem]",children:"Run is compromised"}),(0,d.jsx)("button",{className:"p-px transition-colors rounded-md text-primary hover:bg-primary-wash active:text-white active:bg-primary",onClick:i,"aria-label":"Remove compomised status",children:(0,d.jsx)(h.P.Bin22x22,{})})]}),(0,d.jsx)("p",{className:"text-[0.875rem] text-text-menu leading-[0.875rem] break-all",children:e}),(0,d.jsxs)("a",{className:"w-fit text-primary text-[0.875rem] leading-[1.125rem] bg-primary-wash px-2 py-1 rounded",href:s,target:"_blank",rel:"noreferrer",children:["Bug ",r]})]})));v.displayName="CompromiseInfo";const f=({runId:e})=>{var r;const[s,n]=(0,i.useState)(!1),{data:m,isLoading:u,isError:p}=(0,l.z$)(),{data:g,isLoading:b,isError:h}=l.Ul.endpoints.getRunDetails.useQueryState(null!=e?e:o.skipToken),[f]=(0,l.Js)(),[y]=(0,l.op)(),j=b||u,C=h||p,S=(0,i.useMemo)((()=>Object.entries((null==m?void 0:m.logs)||{}).filter((([e])=>"LOGS_BASE"!==e)).map((([e,r])=>({value:e,displayValue:r.name})))),[null==m?void 0:m.logs]),w=(0,i.useMemo)((()=>{var e,r,s,i,o;return{bugStorageKey:null!=(e=null==S||null==(r=S[0])?void 0:r.value)?e:"",bugId:null!=(s=null==g||null==(i=g.compromised.bug_id)?void 0:i.toString())?s:"",comment:null!=(o=null==g?void 0:g.compromised.comment)?o:""}}),[S,null==g?void 0:g.compromised]),I=(0,i.useCallback)((async({bugId:r,comment:s,bugStorageKey:i})=>{e&&await f({bugId:parseInt(r),comment:s,referenceKey:i,runId:parseInt(e)})}),[e,f]),N=(0,i.useCallback)((async()=>{e&&await y(e)}),[y,e]);return(0,d.jsxs)(t.J2,{onOpenChange:n,children:[(0,d.jsx)(t.xo,{asChild:!0,"aria-label":"Compromised form",children:(0,d.jsx)(c,{isCompromised:(null==g||null==(r=g.compromised)?void 0:r.status)||!1,isLoading:j,isError:C,isActive:s})}),(0,d.jsx)(t.yk,{asChild:!0,sideOffset:5,children:(0,d.jsx)("div",{className:"bg-white rounded-md shadow-popover",children:g&&m?null!=g&&null!=(k=g.compromised)&&k.status?(0,d.jsx)(v,{comment:g.compromised.comment,bugId:g.compromised.bug_id,bugUrl:g.compromised.bug_url,onDeleteClick:N}):(0,d.jsx)(a.M,{children:(0,d.jsx)(x,{bugStorageKeys:S,initialValues:w,onSubmit:I})}):null})})]});var k};f.displayName="CompromiseStatusContainer";const y=f}}]);